{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
{% endblock %}

{% block content %}
<div class="profile-page">
    <div class="background-design"></div>
    <a href="{{ url_for('clientes.index') }}" class="back-button">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Voltar
    </a>

    <div class="profile-container">
        <div class="profile-header">
            <div class="profile-avatar" id="profile-avatar">
                {% if user.foto %}
                    <img src="{{ url_for('static', filename='uploads/' ~ user.foto) }}" alt="Foto de perfil" id="avatar-img">
                {% else %}
                    {# usa placeholder SVG salvo em static/img #}
                    <img src="{{ url_for('static', filename='img/default_profile.svg') }}" alt="Foto padrão" class="placeholder-img" id="avatar-img">
                {% endif %}

                <!-- overlay de câmera (aparece ao passar o mouse) -->
                <div class="camera-overlay" id="camera-overlay" title="Alterar foto">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                        <circle cx="12" cy="13" r="4"></circle>
                    </svg>
                </div>

                <!-- formulário de upload oculto: o arquivo é enviado automaticamente ao selecionar -->
                <form method="post" enctype="multipart/form-data" class="avatar-upload-form" id="avatar-form">
                    <input type="file" name="foto" accept="image/*" class="upload-input" id="avatar-input">
                </form>
            </div>
            <h1>Bem-vindo(a), {{ user.nome }}!</h1>
            <p class="profile-subtitle">Gerencie suas informações pessoais</p>
        </div>

        <div class="profile-info">
            <div class="info-section">
                <h2>Informações Pessoais</h2>
                <div class="info-card">
                    <div class="info-item">
                        <div class="info-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                        </div>
                        <div class="info-content">
                            <label>Nome Completo</label>
                            <span>{{ user.nome }}</span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                <path d="M22 6l-10 7L2 6"/>
                            </svg>
                        </div>
                        <div class="info-content">
                            <label>E-mail</label>
                            <span>{{ user.email }}</span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            </svg>
                        </div>
                        <div class="info-content">
                            <label>Tipo de Conta</label>
                            <span class="account-type {% if user.is_admin %}admin{% else %}client{% endif %}">
                                {% if user.is_admin %}Administrador{% else %}Cliente{% endif %}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    // quando clicar na imagem ou overlay, dispara o input file
    (function(){
        const avatarImg = document.getElementById('avatar-img');
        const avatarInput = document.getElementById('avatar-input');
        const cameraOverlay = document.getElementById('camera-overlay');
        const avatarForm = document.getElementById('avatar-form');

        function triggerInput(){
            if(avatarInput) avatarInput.click();
        }

        if(avatarImg) avatarImg.addEventListener('click', triggerInput);
        if(cameraOverlay) cameraOverlay.addEventListener('click', triggerInput);

        // ao selecionar arquivo, submete o form automaticamente
        if(avatarInput && avatarForm){
            avatarInput.addEventListener('change', function(){
                if(this.files && this.files.length > 0){
                    avatarForm.submit();
                }
            });
        }
    })();
</script>
{% endblock %}