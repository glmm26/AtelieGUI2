<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Ateliê Online{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  {% block styles %}{% endblock %}
  <style>
    #loading-screen{
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: white;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }

    #loading-screen.hidden { opacity: 0; pointer-events: none; }
    .loader img {
      width: 90px;
      animation: pulse 1.5s infinite;
    }

     @keyframes pulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }

         /* Mensagem de sucesso */
    .flash-message {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #4ade80;
      color: white;
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: 500;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      opacity: 0;
      animation: fadeInOut 3s ease forwards;
      z-index: 10000;
    }

    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(-10px); }
      10%, 80% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-10px); }
    }
  </style>

  {% block head %}{% endblock %}
</head>

<body>
  <!-- Tela de carregamento -->
  <div id="loading-screen">
    <div class="loader">
      <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo do Ateliê">
      <p>Carregando...</p>
    </div>
  </div>

  <!-- Mensagem de sucesso -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        {# determine redirect target based on message content #}
        {% set redirect_url = '' %}
        {% if 'Cliente cadastrado' in msg %}
          {% set redirect_url = url_for('clientes.listar_clientes') %}
        {% elif 'Serviço cadastrado' in msg %}
          {% set redirect_url = url_for('servicos.listar_servicos') %}
        {% endif %}
        <div class="flash-message" data-category="{{ category }}" data-redirect="{{ redirect_url }}">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Conteúdo principal -->
  <div id="content" style="opacity: 0; transition: opacity 0.5s;">
    {% block content %}{% endblock %}
  </div>

  <script>
    window.addEventListener("load", () => {
      const loader = document.getElementById("loading-screen");
      const content = document.getElementById("content");
      setTimeout(() => {
        loader.classList.add("hidden");
        content.style.opacity = 1;
      }, 800);
    });

    // Redirecionar após sucesso — agora usa o atributo data-redirect para escolher o destino
    const flashMsg = document.querySelector(".flash-message");
    if (flashMsg) {
      const target = flashMsg.dataset.redirect;
      if (target && target !== '') {
        const loader = document.getElementById("loading-screen");
        loader.classList.remove("hidden"); // Mostra loading antes do redirect
        setTimeout(() => {
          window.location.href = target;
        }, 2000); // Redireciona após 2s de loading extra
      }
    }
  </script>
  {% block scripts %}{% endblock %}
</body>
</html>