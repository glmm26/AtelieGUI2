{% extends "base.html" %}
{% block title %}Listar Materiais{% endblock %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/lista_materiais.css') }}">
{% endblock %}
{% block content %}
<div class="back_adm">
    <div class="container_admin">
        <h2>Gestão de Materiais</h2>

        <div class="admin_layout">
            <nav class="sidebar">
                <a href="{{ url_for('admin_dashboard') }}" class="btn">Sair</a>
                <a href="{{ url_for('clientes.cadastrar_cliente') }}" class="btn">Cadastrar Cliente</a>
                <a href="{{ url_for('clientes.listar_clientes') }}" class="btn">Listar Clientes</a>
                <a href="{{ url_for('servicos.cadastrar_servico') }}" class="btn">Cadastrar Serviço</a>
                <a href="{{ url_for('servicos.listar_servicos') }}" class="btn">Listar Serviços</a>
                <a href="{{ url_for('materiais.cadastrar_material') }}" class="btn">Cadastrar Material</a>
                <a href="{{ url_for('materiais.listar_materiais') }}" class="btn active">Listar Materiais</a>
            </nav>

            <main class="main_panel">
                <div class="materiais-container">
                    <div class="materiais-header">
                        <h3>Estoque de Materiais</h3>
                        <a href="{{ url_for('materiais.cadastrar_material') }}" class="btn-add">Adicionar Material</a>
                    </div>

                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category }}">{{ message }}</div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <div class="materiais-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Quantidade</th>
                                    <th>Unidade</th>
                                    <th>Preço Unit.</th>
                                    <th>Última Atualização</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for material in materiais %}
                                <tr>
                                    <td>{{ material.nome }}</td>
                                    <td>{{ material.quantidade }}</td>
                                    <td>{{ material.unidade_medida }}</td>
                                    <td>{% if material.preco_unitario %}R$ {{ "%.2f"|format(material.preco_unitario) }}{% else %}-{% endif %}</td>
                                    <td>{{ material.data_atualizacao.strftime('%d/%m/%Y %H:%M') }}</td>
                                    <td class="acoes">
                                        <a href="{{ url_for('materiais.editar_material', id=material.id) }}" class="btn-edit">Editar</a>
                                        <form action="{{ url_for('materiais.excluir_material', id=material.id) }}" method="POST" style="display: inline;">
                                            <button type="submit" class="btn-delete" onclick="return confirm('Tem certeza que deseja excluir este material?')">Excluir</button>
                                        </form>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="6" class="no-data">Nenhum material cadastrado</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>
</div>
{% endblock %}